# 芥子博客技术架构文档

## 1. 架构设计

```mermaid
graph TD
    A[用户浏览器] --> B[React前端应用]
    B --> C[Electron主进程]
    C --> D[SQLite数据库]
    C --> E[文件系统]
    
    subgraph "前端层"
        B
    end
    
    subgraph "应用层"
        C
    end
    
    subgraph "数据层"
        D
        E
    end
```

## 2. 技术描述

* 前端：React\@18 + TypeScript + Tailwind CSS + Vite

* 桌面应用：Electron\@latest

* 数据库：SQLite3

* Markdown处理：react-markdown + remark-gfm

* 编辑器：@uiw/react-md-editor

* 图片处理：本地文件系统存储

## 3. 路由定义

| 路由           | 用途             |
| ------------ | -------------- |
| /            | 首页，显示文章列表和分类导航 |
| /article/:id | 文章详情页，显示完整文章内容 |
| /edit        | 新建文章编辑页        |
| /edit/:id    | 编辑现有文章页面       |
| /categories  | 分类管理页面         |
| /settings    | 设置页面，包含备份恢复功能  |

## 4. API定义

### 4.1 核心API

文章相关接口

```
GET /api/articles
```

请求参数：

| 参数名称     | 参数类型   | 是否必需  | 描述        |
| -------- | ------ | ----- | --------- |
| category | string | false | 按分类筛选     |
| search   | string | false | 搜索关键词     |
| page     | number | false | 页码，默认1    |
| limit    | number | false | 每页数量，默认10 |

响应：

| 参数名称     | 参数类型       | 描述    |
| -------- | ---------- | ----- |
| articles | Article\[] | 文章列表  |
| total    | number     | 总数量   |
| hasMore  | boolean    | 是否有更多 |

```
POST /api/articles
```

请求：

| 参数名称     | 参数类型      | 是否必需  | 描述         |
| -------- | --------- | ----- | ---------- |
| title    | string    | true  | 文章标题       |
| content  | string    | true  | Markdown内容 |
| category | string    | true  | 分类名称       |
| tags     | string\[] | false | 标签数组       |

响应：

| 参数名称      | 参数类型    | 描述     |
| --------- | ------- | ------ |
| success   | boolean | 操作结果   |
| articleId | number  | 新建文章ID |

分类管理接口

```
GET /api/categories
POST /api/categories
PUT /api/categories/:id
DELETE /api/categories/:id
```

图片上传接口

```
POST /api/upload/image
```

数据备份接口

```
POST /api/backup/export
POST /api/backup/import
```

## 5. 服务器架构图

```mermaid
graph TD
    A[React组件层] --> B[状态管理层]
    B --> C[API服务层]
    C --> D[数据访问层]
    D --> E[(SQLite数据库)]
    
    subgraph "前端架构"
        A
        B
    end
    
    subgraph "Electron主进程"
        C
        D
    end
```

## 6. 数据模型

### 6.1 数据模型定义

```mermaid
erDiagram
    ARTICLES ||--o{ ARTICLE_TAGS : has
    CATEGORIES ||--o{ ARTICLES : contains
    TAGS ||--o{ ARTICLE_TAGS : referenced
    
    ARTICLES {
        integer id PK
        string title
        text content
        string excerpt
        integer category_id FK
        datetime created_at
        datetime updated_at
        boolean is_published
    }
    
    CATEGORIES {
        integer id PK
        string name
        string description
        datetime created_at
    }
    
    TAGS {
        integer id PK
        string name
        datetime created_at
    }
    
    ARTICLE_TAGS {
        integer article_id FK
        integer tag_id FK
    }
    
    IMAGES {
        integer id PK
        string filename
        string original_name
        string file_path
        integer file_size
        datetime created_at
    }
```

### 6.2 数据定义语言

文章表 (articles)

```sql
-- 创建文章表
CREATE TABLE articles (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    title VARCHAR(255) NOT NULL,
    content TEXT NOT NULL,
    excerpt TEXT,
    category_id INTEGER,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    is_published BOOLEAN DEFAULT 1,
    FOREIGN KEY (category_id) REFERENCES categories(id)
);

-- 创建分类表
CREATE TABLE categories (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name VARCHAR(100) NOT NULL UNIQUE,
    description TEXT,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- 创建标签表
CREATE TABLE tags (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name VARCHAR(50) NOT NULL UNIQUE,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- 创建文章标签关联表
CREATE TABLE article_tags (
    article_id INTEGER,
    tag_id INTEGER,
    PRIMARY KEY (article_id, tag_id),
    FOREIGN KEY (article_id) REFERENCES articles(id) ON DELETE CASCADE,
    FOREIGN KEY (tag_id) REFERENCES tags(id) ON DELETE CASCADE
);

-- 创建图片表
CREATE TABLE images (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    filename VARCHAR(255) NOT NULL,
    original_name VARCHAR(255) NOT NULL,
    file_path VARCHAR(500) NOT NULL,
    file_size INTEGER,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- 创建索引
CREATE INDEX idx_articles_category ON articles(category_id);
CREATE INDEX idx_articles_created_at ON articles(created_at DESC);
CREATE INDEX idx_articles_title ON articles(title);
CREATE INDEX idx_article_tags_article ON article_tags(article_id);
CREATE INDEX idx_article_tags_tag ON article_tags(tag_id);

-- 插入初始数据
INSERT INTO categories (name, description) VALUES 
('日常心得', '记录日常生活的感悟和思考'),
('读书笔记', '阅读书籍后的总结和感想'),
('技术分享', '技术学习和实践的记录');

INSERT INTO tags (name) VALUES 
('生活'), ('思考'), ('成长'), ('技术'), ('读书');
```

